name: Docker - Debian
on:
  workflow_dispatch:
  schedule:
    - cron: '57 12 * * 1'
  push:
    branches: [ "main" ]

env:
  SUFFIX:
  DOCKERFILE: debian/Dockerfile

jobs:
  vars:
    runs-on: ubuntu-latest
    outputs:
      dockerfile: ${{ env.DOCKERFILE }}
      suffix: ${{ env.SUFFIX }}
    steps:
      - run: echo "Exposing env vars"
  invoke-build:
    uses: ./.github/workflows/docker-publish.yml
    needs: vars
    secrets: inherit
    with:
      dockerfile: ${{ needs.vars.outputs.dockerfile }}
      checkout: master
      suffix: ${{ needs.vars.outputs.suffix }}
#  get-tag:
#    uses: oprypin/find-latest-tag@v1
#    with:
#      repository: eliasdoehne/stellaris-dashboard
#      releases-only: true
#    id: upstream
#  invoke-build:
#    uses: ./.github/workflows/docker-publish.yml
#    needs: vars
#    secrets: inherit
#    with:
#      dockerfile: ${{ needs.vars.outputs.dockerfile }}
#      checkout: ${{ steps.upstream.outputs.tag }}
#      suffix: ${{ steps.upstream.outputs.tag }}.${{ needs.vars.outputs.suffix }}
